<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>REGERENT PRO</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --noir:#080808;--or:#C9A84C;--or-light:#E8C97A;--blanc:#FFFFFF;
    --gris:#141414;--gris-mid:#222;--gris-bord:#1E1E1E;--gris-texte:#666;
    --vert:#2ECC71;--jaune:#F39C12;--rouge:#E74C3C;--rouge-soft:#FF6B6B;--bleu:#3498DB;
  }
  *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{background:var(--noir);color:var(--blanc);font-family:'DM Sans',sans-serif;min-height:100vh;overflow-x:hidden}
  #loader{position:fixed;inset:0;background:var(--noir);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000;gap:16px}
  .loader-logo{font-family:'Bebas Neue';font-size:36px;letter-spacing:6px}
  .loader-logo span{color:var(--or)}
  .loader-bar{width:120px;height:2px;background:#1A1A1A;border-radius:2px;overflow:hidden}
  .loader-fill{height:100%;background:var(--or);animation:load 1.5s ease-in-out infinite}
  @keyframes load{0%{width:0%}50%{width:80%}100%{width:100%}}
  .screen{display:none;min-height:100vh;flex-direction:column}
  .screen.active{display:flex}
  .header{padding:52px 20px 16px;display:flex;align-items:center;justify-content:space-between}
  .logo{font-family:'Bebas Neue';font-size:20px;letter-spacing:3px}
  .logo span{color:var(--or)}
  .role-badge{font-size:10px;font-weight:700;padding:4px 10px;border-radius:20px;letter-spacing:1px}
  .role-badge.joueur{background:rgba(201,168,76,0.15);color:var(--or);border:1px solid rgba(201,168,76,0.3)}
  .role-badge.staff{background:rgba(52,152,219,0.15);color:var(--bleu);border:1px solid rgba(52,152,219,0.3)}
  .content{flex:1;overflow-y:auto;padding:0 20px 100px;-webkit-overflow-scrolling:touch}
  .bottom-nav{position:fixed;bottom:0;left:0;right:0;background:#0A0A0A;border-top:1px solid var(--gris-bord);display:flex;padding:8px 0 20px;z-index:100}
  .nav-tab{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer;padding:6px;color:var(--gris-texte);font-size:10px;font-weight:500;letter-spacing:0.5px;transition:color 0.2s}
  .nav-tab.active{color:var(--or)}
  .nav-tab svg{width:22px;height:22px}
  .card{background:var(--gris);border-radius:20px;padding:20px;margin-bottom:16px;border:1px solid var(--gris-bord)}
  .card-or{background:linear-gradient(135deg,#1A1A08,#130F00);border:1px solid rgba(201,168,76,0.25)}
  .score-giant{font-family:'Bebas Neue';font-size:80px;line-height:1;letter-spacing:-2px}
  .score-giant.vert{color:var(--vert)}.score-giant.jaune{color:var(--jaune)}.score-giant.rouge{color:var(--rouge)}
  .score-bar{height:4px;background:#222;border-radius:4px;overflow:hidden;margin-top:14px}
  .score-fill{height:100%;border-radius:4px;transition:width 1s ease}
  .score-fill.vert{background:var(--vert)}.score-fill.jaune{background:var(--jaune)}.score-fill.rouge{background:var(--rouge)}
  .metrics-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .metric{background:var(--gris);border-radius:14px;padding:14px;border:1px solid var(--gris-bord)}
  .metric-val{font-family:'Bebas Neue';font-size:26px;line-height:1}
  .metric-lbl{font-size:10px;color:var(--gris-texte);margin-top:3px;letter-spacing:0.5px}
  .metric-trend{font-size:11px;margin-top:5px;font-weight:500}
  .trend-up{color:var(--vert)}.trend-down{color:var(--rouge)}.trend-neutral{color:var(--gris-texte)}
  .alert-card{background:rgba(231,76,60,0.08);border:1px solid rgba(231,76,60,0.25);border-radius:16px;padding:14px;margin-bottom:14px;display:flex;gap:12px}
  .alert-icon{width:34px;height:34px;background:rgba(231,76,60,0.15);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
  .alert-title{font-size:12px;font-weight:600;color:var(--rouge-soft);margin-bottom:3px}
  .alert-text{font-size:11px;color:var(--gris-texte);line-height:1.5}
  .protocol-step{display:flex;align-items:flex-start;gap:10px;background:rgba(255,255,255,0.03);padding:10px 12px;border-radius:10px;margin-bottom:6px}
  .step-num{width:22px;height:22px;background:var(--or);color:var(--noir);border-radius:50%;font-size:11px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px}
  .step-text{font-size:13px}
  .step-detail{font-size:11px;color:var(--gris-texte);margin-top:2px}
  .section-title{font-family:'Bebas Neue';font-size:16px;letter-spacing:2px;margin:20px 0 10px}
  .q-block{margin-bottom:24px}
  .q-label{font-size:10px;color:var(--or);letter-spacing:2px;margin-bottom:6px}
  .q-text{font-size:15px;font-weight:500;margin-bottom:12px;line-height:1.4}
  .slider-val{text-align:center;font-family:'Bebas Neue';font-size:40px;color:var(--or);margin-bottom:4px}
  input[type=range]{width:100%;-webkit-appearance:none;height:6px;border-radius:6px;background:var(--gris-mid);outline:none}
  input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:24px;height:24px;border-radius:50%;background:var(--or);cursor:pointer;box-shadow:0 0 0 4px rgba(201,168,76,0.2)}
  .slider-labels{display:flex;justify-content:space-between;font-size:10px;color:var(--gris-texte);margin-top:4px}
  .chip-grid{display:flex;flex-wrap:wrap;gap:8px}
  .chip{background:var(--gris);border:1px solid #2A2A2A;border-radius:10px;padding:9px 14px;font-size:12px;color:var(--gris-texte);cursor:pointer;transition:all 0.2s;font-family:'DM Sans'}
  .chip.sel-pain{background:rgba(231,76,60,0.12);border-color:var(--rouge);color:var(--rouge-soft)}
  .chip.sel-equip{background:rgba(201,168,76,0.12);border-color:var(--or);color:var(--or-light)}
  .divider{height:1px;background:var(--gris-bord);margin:20px 0}
  .prog-wrap{padding:0 20px 2px}
  .prog-bar{height:2px;background:#1A1A1A;border-radius:2px;overflow:hidden}
  .prog-fill{height:100%;background:var(--or);transition:width 0.4s}
  .prog-label{font-size:10px;color:var(--gris-texte);text-align:right;padding:2px 20px 0}
  .player-row{background:var(--gris);border-radius:14px;padding:12px 14px;margin-bottom:8px;border:1px solid var(--gris-bord);display:flex;align-items:center;gap:10px}
  .player-avatar{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue';font-size:14px;flex-shrink:0}
  .player-info{flex:1;min-width:0}
  .player-name{font-weight:600;font-size:13px}
  .player-detail{font-size:11px;color:var(--gris-texte);margin-top:2px}
  .score-badge{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue';font-size:15px;flex-shrink:0}
  .score-badge.vert{background:rgba(46,204,113,0.15);color:var(--vert);border:1px solid rgba(46,204,113,0.3)}
  .score-badge.jaune{background:rgba(243,156,18,0.15);color:var(--jaune);border:1px solid rgba(243,156,18,0.3)}
  .score-badge.rouge{background:rgba(231,76,60,0.15);color:var(--rouge-soft);border:1px solid rgba(231,76,60,0.3)}
  .score-badge.vide{background:var(--gris-mid);color:var(--gris-texte);border:1px solid #222}
  .injury-card{background:var(--gris);border-radius:14px;padding:14px;margin-bottom:10px;border:1px solid var(--gris-bord)}
  .badge{font-size:10px;padding:3px 8px;border-radius:20px;font-weight:600}
  .badge-rouge{background:rgba(231,76,60,0.15);color:var(--rouge-soft)}
  .badge-vert{background:rgba(46,204,113,0.15);color:var(--vert)}
  .body-zones{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:12px}
  .body-zone{padding:9px 10px;border-radius:10px;font-size:12px;font-weight:500;display:flex;align-items:center;gap:6px}
  .body-zone.rouge{background:rgba(231,76,60,0.12);color:var(--rouge-soft)}
  .body-zone.orange{background:rgba(243,156,18,0.12);color:var(--jaune)}
  .body-zone.vert{background:rgba(46,204,113,0.12);color:var(--vert)}
  .zone-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
  .stats-strip{display:flex;gap:1px;margin:14px 0}
  .stat-item{flex:1;background:var(--gris);padding:12px 6px;text-align:center}
  .stat-item:first-child{border-radius:10px 0 0 10px}
  .stat-item:last-child{border-radius:0 10px 10px 0}
  .stat-val{font-family:'Bebas Neue';font-size:20px;color:var(--or)}
  .stat-lbl{font-size:9px;color:var(--gris-texte);letter-spacing:0.5px;margin-top:2px}
  .profile-avatar-lg{width:72px;height:72px;background:linear-gradient(135deg,var(--or),var(--or-light));border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue';font-size:28px;color:var(--noir);margin:0 auto 10px}
  .equip-item{background:var(--gris);border-radius:12px;padding:12px 14px;margin-bottom:8px;border:1px solid var(--gris-bord);display:flex;align-items:center;justify-content:space-between}
  .equip-status{font-size:10px;padding:4px 10px;border-radius:20px;font-weight:600}
  .equip-status.active{background:rgba(46,204,113,0.15);color:var(--vert)}
  .btn-or{width:100%;background:var(--or);color:var(--noir);border:none;border-radius:14px;padding:16px;font-family:'Bebas Neue';font-size:18px;letter-spacing:2px;cursor:pointer;margin-top:8px;transition:opacity 0.2s}
  .btn-or:active{opacity:0.85}
  .btn-sec{width:100%;background:transparent;color:var(--blanc);border:1px solid #2A2A2A;border-radius:14px;padding:14px;font-family:'DM Sans';font-size:13px;cursor:pointer;margin-top:8px}
  .btn-danger{background:transparent;color:var(--rouge-soft);border:1px solid rgba(231,76,60,0.3);border-radius:10px;padding:8px 14px;font-size:12px;cursor:pointer;font-family:'DM Sans'}
  #successOverlay{display:none;position:fixed;inset:0;background:var(--noir);z-index:500;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:40px}
  #successOverlay.show{display:flex}
  .success-icon{width:72px;height:72px;background:rgba(46,204,113,0.15);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:32px;margin-bottom:20px;animation:pulse 2s infinite}
  @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
  #toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:#1A1A1A;color:var(--blanc);padding:12px 20px;border-radius:12px;font-size:13px;border:1px solid #2A2A2A;z-index:600;opacity:0;transition:opacity 0.3s;white-space:nowrap}
  #toast.show{opacity:1}
  .empty-state{text-align:center;padding:40px 20px;color:var(--gris-texte)}
  .input-field{background:var(--gris);border:1px solid var(--gris-bord);border-radius:12px;padding:14px 16px;color:var(--blanc);font-family:'DM Sans';font-size:15px;outline:none;width:100%;transition:border-color 0.2s}
  .input-field:focus{border-color:var(--or)}
  .input-select{background:var(--gris);border:1px solid var(--gris-bord);border-radius:12px;padding:14px 16px;color:var(--blanc);font-family:'DM Sans';font-size:15px;outline:none;width:100%;-webkit-appearance:none}
  .input-label{font-size:11px;color:var(--gris-texte);letter-spacing:1px;margin-bottom:6px;display:block}
  .input-group{margin-bottom:12px}
  .auth-error{background:rgba(231,76,60,0.1);border:1px solid rgba(231,76,60,0.3);border-radius:10px;padding:12px;font-size:13px;color:var(--rouge-soft);text-align:center;display:none;margin-top:8px}
  .auth-tabs{display:flex;background:var(--gris);border-radius:12px;padding:4px;margin-bottom:24px}
  .auth-tab{flex:1;padding:10px;text-align:center;border-radius:9px;font-size:13px;font-weight:600;cursor:pointer;color:var(--gris-texte);transition:all 0.2s}
  .auth-tab.active{background:var(--or);color:var(--noir)}
</style>
</head>
<body>

<div id="loader">
  <div class="loader-logo">REGE<span>RENT</span></div>
  <div style="font-size:11px;letter-spacing:3px;color:var(--gris-texte)">PRO</div>
  <div class="loader-bar"><div class="loader-fill"></div></div>
</div>

<div class="screen" id="screen-auth">
  <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px 24px">
    <div style="font-family:'Bebas Neue';font-size:40px;letter-spacing:6px;margin-bottom:4px">REGE<span style="color:var(--or)">RENT</span></div>
    <div style="font-size:11px;letter-spacing:3px;color:var(--gris-texte);margin-bottom:40px">PRO · PLATEFORME RECUPERATION</div>
    <div class="auth-tabs" style="width:100%;max-width:340px">
      <div class="auth-tab active" id="tabLogin" onclick="switchTab('login')">CONNEXION</div>
      <div class="auth-tab" id="tabRegister" onclick="switchTab('register')">INSCRIPTION</div>
    </div>
    <div id="formLogin" style="width:100%;max-width:340px">
      <div class="input-group"><label class="input-label">EMAIL</label><input class="input-field" type="email" id="lEmail" placeholder="ton@email.com"></div>
      <div class="input-group"><label class="input-label">MOT DE PASSE</label><input class="input-field" type="password" id="lPwd" placeholder="********"></div>
      <div class="auth-error" id="lErr"></div>
      <button class="btn-or" onclick="doLogin()">CONNEXION</button>
    </div>
    <div id="formRegister" style="width:100%;max-width:340px;display:none">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px">
        <div><label class="input-label">PRENOM</label><input class="input-field" type="text" id="rPrenom" placeholder="Kofi"></div>
        <div><label class="input-label">NOM</label><input class="input-field" type="text" id="rNom" placeholder="Diabate"></div>
      </div>
      <div class="input-group"><label class="input-label">EMAIL</label><input class="input-field" type="email" id="rEmail" placeholder="ton@email.com"></div>
      <div class="input-group"><label class="input-label">MOT DE PASSE</label><input class="input-field" type="password" id="rPwd" placeholder="min. 8 caracteres"></div>
      <div class="input-group"><label class="input-label">ROLE</label>
        <select class="input-select" id="rRole" onchange="togglePosition()">
          <option value="joueur">Joueur</option>
          <option value="staff">Staff medical</option>
        </select>
      </div>
      <div class="input-group" id="posGroup"><label class="input-label">POSITION</label>
        <select class="input-select" id="rPosition">
          <option value="">Selectioner</option>
          <option>Gardien</option><option>Defenseur central</option><option>Lateral</option>
          <option>Milieu defensif</option><option>Milieu central</option><option>Milieu offensif</option>
          <option>Ailier</option><option>Attaquant</option>
        </select>
      </div>
      <div class="input-group"><label class="input-label">CLUB</label><input class="input-field" type="text" id="rClub" placeholder="Nom du club"></div>
      <div class="auth-error" id="rErr"></div>
      <button class="btn-or" onclick="doRegister()">CREER MON COMPTE</button>
    </div>
  </div>
</div>

<div id="successOverlay">
  <div class="success-icon">V</div>
  <div style="font-family:'Bebas Neue';font-size:28px;letter-spacing:2px;margin-bottom:10px">BILAN ENVOYE</div>
  <div id="sScore" style="font-family:'Bebas Neue';font-size:72px;line-height:1;margin-bottom:8px"></div>
  <div id="sMsg" style="font-size:14px;color:var(--gris-texte);margin-bottom:24px;line-height:1.6"></div>
  <button class="btn-or" style="max-width:260px" onclick="closeSuccess()">VOIR MON DASHBOARD</button>
</div>

<div id="toast"></div>

<div class="screen" id="screen-home">
  <div class="header">
    <div>
      <div id="greeting" style="font-size:10px;color:var(--gris-texte);letter-spacing:1px;margin-bottom:2px">BON MATIN</div>
      <div class="logo">REGE<span>RENT</span> PRO</div>
    </div>
    <div class="role-badge joueur">JOUEUR</div>
  </div>
  <div class="content">
    <div class="card" style="position:relative;overflow:hidden">
      <div style="position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--or),var(--or-light))"></div>
      <div style="font-size:10px;letter-spacing:2px;color:var(--gris-texte);margin-bottom:6px">REGERENT SCORE</div>
      <div id="homeScore" class="score-giant jaune">--</div>
      <div id="homeMsg" style="font-size:12px;color:var(--gris-texte);margin-top:4px"></div>
      <div class="score-bar"><div id="homeFill" class="score-fill jaune" style="width:0%"></div></div>
    </div>
    <div id="alerteDiv" class="alert-card" style="display:none">
      <div class="alert-icon">!</div>
      <div><div class="alert-title">REGERENT DETECTE UN SIGNAL</div><div class="alert-text" id="alerteTxt"></div></div>
    </div>
    <div class="section-title">TES DONNEES DU JOUR</div>
    <div class="metrics-grid">
      <div class="metric"><div style="font-size:18px;margin-bottom:6px">Z</div><div class="metric-val" id="mS">--</div><div class="metric-lbl">SOMMEIL</div><div class="metric-trend" id="mST"></div></div>
      <div class="metric"><div style="font-size:18px;margin-bottom:6px">+</div><div class="metric-val" id="mP">--</div><div class="metric-lbl">PHYSIQUE</div></div>
      <div class="metric"><div style="font-size:18px;margin-bottom:6px">O</div><div class="metric-val" id="mM">--</div><div class="metric-lbl">MENTAL</div></div>
      <div class="metric"><div style="font-size:18px;margin-bottom:6px">*</div><div class="metric-val" id="mD">--</div><div class="metric-lbl">DOULEUR</div></div>
    </div>
    <div id="protocoleDiv" class="card card-or" style="display:none">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
        <div style="width:36px;height:36px;background:rgba(201,168,76,0.15);border-radius:10px;display:flex;align-items:center;justify-content:center">*</div>
        <div><div style="font-weight:600;font-size:13px;color:var(--or-light)">PROTOCOLE CE SOIR</div><div style="font-size:11px;color:var(--gris-texte)">Base sur tes donnees</div></div>
      </div>
      <div id="protocoleSteps"></div>
    </div>
    <div id="bilanCTA" class="card" style="text-align:center">
      <div style="font-size:13px;color:var(--gris-texte);margin-bottom:4px">Bilan matinal en attente</div>
      <div style="font-size:14px;font-weight:600;margin-bottom:14px">2 minutes pour calculer ton score</div>
      <button class="btn-or" onclick="goTo('screen-questionnaire')">COMPLETER MON BILAN</button>
    </div>
    <div class="card" style="margin-top:8px">
      <div style="font-size:13px;font-weight:500">Recuperation meilleure que <span style="color:var(--or)" id="classement">--</span>% des joueurs REGERENT.</div>
    </div>
    <div style="margin-top:16px"><button class="btn-danger" onclick="doLogout()">Se deconnecter</button></div>
  </div>
</div>

<div class="screen" id="screen-questionnaire">
  <div class="header" style="padding-bottom:8px">
    <div style="cursor:pointer;color:var(--gris-texte);font-size:13px" onclick="goTo('screen-home')">Retour</div>
    <div class="logo" style="font-size:14px">BILAN MATINAL</div>
    <div style="width:50px"></div>
  </div>
  <div class="prog-wrap"><div class="prog-bar"><div class="prog-fill" id="pFill" style="width:0%"></div></div></div>
  <div class="prog-label" id="pLabel">0 / 6</div>
  <div class="content" style="padding-top:8px">
    <div class="q-block">
      <div class="q-label">SOMMEIL</div>
      <div class="q-text">Combien d heures as-tu dormi ?</div>
      <div class="slider-val" id="sv1">7h</div>
      <input type="range" min="4" max="11" value="7" step="0.5" id="r1" oninput="sv1.textContent=this.value+'h';calcP()">
      <div class="slider-labels"><span>4h</span><span>11h</span></div>
    </div>
    <div class="divider"></div>
    <div class="q-block">
      <div class="q-label">SOMMEIL</div>
      <div class="q-text">Qualite de ton sommeil ?</div>
      <div class="slider-val" id="sv2">7</div>
      <input type="range" min="1" max="10" value="7" id="r2" oninput="sv2.textContent=this.value;calcP()">
      <div class="slider-labels"><span>Mauvaise</span><span>Parfaite</span></div>
    </div>
    <div class="divider"></div>
    <div class="q-block">
      <div class="q-label">CORPS</div>
      <div class="q-text">Comment tu te sens physiquement ?</div>
      <div class="slider-val" id="sv3">7</div>
      <input type="range" min="1" max="10" value="7" id="r3" oninput="sv3.textContent=this.value;calcP()">
      <div class="slider-labels"><span>Detruit</span><span>Parfait</span></div>
    </div>
    <div class="divider"></div>
    <div class="q-block">
      <div class="q-label">DOULEUR</div>
      <div class="q-text">Tu as une douleur quelque part ?</div>
      <div class="chip-grid" id="painChips">
        <div class="chip" onclick="tPain(this)">Aucune</div>
        <div class="chip" onclick="tPain(this)">Dos</div>
        <div class="chip" onclick="tPain(this)">Genou G</div>
        <div class="chip" onclick="tPain(this)">Genou D</div>
        <div class="chip" onclick="tPain(this)">Ischio G</div>
        <div class="chip" onclick="tPain(this)">Ischio D</div>
        <div class="chip" onclick="tPain(this)">Cheville G</div>
        <div class="chip" onclick="tPain(this)">Cheville D</div>
        <div class="chip" onclick="tPain(this)">Autre</div>
      </div>
    </div>
    <div class="divider"></div>
    <div class="q-block">
      <div class="q-label">MENTAL</div>
      <div class="q-text">Comment tu te sens mentalement ?</div>
      <div class="slider-val" id="sv4">7</div>
      <input type="range" min="1" max="10" value="7" id="r4" oninput="sv4.textContent=this.value;calcP()">
      <div class="slider-labels"><span>A plat</span><span>Motive</span></div>
    </div>
    <div class="divider"></div>
    <div class="q-block">
      <div class="q-label">RECUPERATION FAITE</div>
      <div class="q-text">Qu as-tu utilise hier soir ?</div>
      <div class="chip-grid" id="equipChips">
        <div class="chip" onclick="tEquip(this)" data-v="OXY_ONE">OXY ONE</div>
        <div class="chip" onclick="tEquip(this)" data-v="CRYO_ONE">CRYO ONE</div>
        <div class="chip" onclick="tEquip(this)" data-v="PRESSO_ONE">PRESSO ONE</div>
        <div class="chip" onclick="tEquip(this)" data-v="BAND">BAND</div>
        <div class="chip" onclick="tEquip(this)" data-v="Rien">Rien</div>
      </div>
    </div>
    <button class="btn-or" id="submitBtn" onclick="submitBilan()">CALCULER MON SCORE</button>
    <button class="btn-sec" onclick="goTo('screen-home')">Plus tard</button>
  </div>
</div>

<div class="screen" id="screen-injuries">
  <div class="header"><div class="logo">REGE<span>RENT</span> PRO</div><div class="role-badge joueur">CORPS</div></div>
  <div class="content">
    <div class="section-title">TA CARTE CORPORELLE</div>
    <div class="card">
      <div style="font-size:11px;color:var(--gris-texte)">Zones identifiees par REGERENT IA</div>
      <div class="body-zones" id="bodyZones"><div style="color:var(--gris-texte);font-size:12px;margin-top:8px">Chargement...</div></div>
      <div style="margin-top:10px;font-size:10px;color:var(--gris-texte)">Rouge: Fragile · Orange: Surveiller · Vert: OK</div>
    </div>
    <div class="section-title">AVANT VS AVEC REGERENT</div>
    <div class="card">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div style="text-align:center;padding:12px;background:#0A0A0A;border-radius:12px">
          <div style="font-size:10px;color:var(--gris-texte);margin-bottom:6px">AVANT</div>
          <div id="avB" style="font-family:'Bebas Neue';font-size:32px;color:var(--rouge)">--</div>
          <div style="font-size:11px;color:var(--gris-texte)">blessures</div>
          <div id="avD" style="font-family:'Bebas Neue';font-size:20px;color:var(--rouge);margin-top:4px">--</div>
          <div style="font-size:11px;color:var(--gris-texte)">duree moy.</div>
        </div>
        <div style="text-align:center;padding:12px;background:#0A0A0A;border-radius:12px">
          <div style="font-size:10px;color:var(--or);margin-bottom:6px">AVEC REGERENT</div>
          <div id="avcB" style="font-family:'Bebas Neue';font-size:32px;color:var(--vert)">--</div>
          <div style="font-size:11px;color:var(--gris-texte)">blessures</div>
          <div id="avcD" style="font-family:'Bebas Neue';font-size:20px;color:var(--vert);margin-top:4px">--</div>
          <div style="font-size:11px;color:var(--gris-texte)">duree moy.</div>
        </div>
      </div>
      <div id="gainPct" style="text-align:center;margin-top:10px;font-size:13px;font-weight:600;color:var(--or)"></div>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin:20px 0 10px">
      <div class="section-title" style="margin:0">HISTORIQUE</div>
      <button onclick="addInjury()" style="background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.3);color:var(--or);border-radius:8px;padding:6px 12px;font-size:12px;cursor:pointer;font-family:'DM Sans'">+ Ajouter</button>
    </div>
    <div id="injList"><div class="empty-state"><div>+</div><div style="font-size:13px;margin-top:8px">Aucune blessure enregistree.</div></div></div>
    <div class="section-title">MON PASSEPORT</div>
    <div class="card card-or">
      <div style="font-family:'Bebas Neue';font-size:13px;letter-spacing:3px;color:var(--or);margin-bottom:12px">PASSEPORT RECUPERATION</div>
      <div class="stats-strip">
        <div class="stat-item"><div class="stat-val" id="pSess">0</div><div class="stat-lbl">SESSIONS</div></div>
        <div class="stat-item"><div class="stat-val" id="pDispo">--</div><div class="stat-lbl">DISPO %</div></div>
        <div class="stat-item"><div class="stat-val" id="pScore">--</div><div class="stat-lbl">SCORE MOY.</div></div>
      </div>
    </div>
  </div>
</div>

<div class="screen" id="screen-staff">
  <div class="header"><div class="logo">REGE<span>RENT</span> PRO</div><div class="role-badge staff">STAFF</div></div>
  <div class="content">
    <div class="card" style="margin-bottom:16px">
      <div style="font-size:10px;color:var(--gris-texte);letter-spacing:1px;margin-bottom:10px" id="staffDate">--</div>
      <div style="display:flex">
        <div style="flex:1;text-align:center"><div style="font-family:'Bebas Neue';font-size:28px;color:var(--vert)" id="sBilans">0</div><div style="font-size:10px;color:var(--gris-texte)">BILANS</div></div>
        <div style="flex:1;text-align:center"><div style="font-family:'Bebas Neue';font-size:28px;color:var(--rouge)" id="sAlertes">0</div><div style="font-size:10px;color:var(--gris-texte)">ALERTES</div></div>
        <div style="flex:1;text-align:center"><div style="font-family:'Bebas Neue';font-size:28px;color:var(--jaune)" id="sAttente">0</div><div style="font-size:10px;color:var(--gris-texte)">EN ATTENTE</div></div>
      </div>
    </div>
    <div id="staffAlerts"></div>
    <div class="section-title">MES JOUEURS</div>
    <div id="staffList"><div class="empty-state"><div>+</div><div style="font-size:13px;margin-top:8px">Aucun joueur ne t a encore donne acces.</div></div></div>
    <div style="margin-top:16px"><button class="btn-danger" onclick="doLogout()">Se deconnecter</button></div>
  </div>
</div>

<div class="screen" id="screen-profile">
  <div class="header"><div class="logo">REGE<span>RENT</span> PRO</div><div class="role-badge joueur">PROFIL</div></div>
  <div class="content">
    <div style="text-align:center;padding:16px 0 24px">
      <div class="profile-avatar-lg" id="pAvatar">?</div>
      <div style="font-family:'Bebas Neue';font-size:22px;letter-spacing:2px" id="pName">--</div>
      <div style="font-size:12px;color:var(--gris-texte);margin-top:4px" id="pSub">--</div>
    </div>
    <div class="section-title">MON EQUIPEMENT</div>
    <div class="equip-item"><div><div style="font-weight:600;font-size:13px">REGERENT BAND</div><div style="font-size:11px;color:var(--gris-texte)">Bracelet connecte</div></div><div class="equip-status active">ACTIF</div></div>
    <div class="equip-item"><div><div style="font-weight:600;font-size:13px">OXY ONE</div><div style="font-size:11px;color:var(--gris-texte)">Camera hyperbare</div></div><div class="equip-status active">ACTIF</div></div>
    <div class="section-title">ABONNEMENT</div>
    <div class="card card-or">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><div style="font-weight:600;font-size:14px;color:var(--or-light)">REGERENT PRO</div><div style="font-size:11px;color:var(--gris-texte);margin-top:2px">Actif</div></div>
        <div style="font-family:'Bebas Neue';font-size:22px;color:var(--or)">29 EUR/mois</div>
      </div>
    </div>
    <div style="margin-top:16px"><button class="btn-danger" onclick="doLogout()">Se deconnecter</button></div>
  </div>
</div>

<nav class="bottom-nav" id="nav" style="display:none">
  <div class="nav-tab active" onclick="goTo('screen-home')" id="tab-home">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg>Score
  </div>
  <div class="nav-tab" onclick="goTo('screen-questionnaire')" id="tab-questionnaire">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/></svg>Bilan
  </div>
  <div class="nav-tab" onclick="goTo('screen-injuries')" id="tab-injuries">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>Corps
  </div>
  <div class="nav-tab" onclick="goTo('screen-staff')" id="tab-staff">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>Staff
  </div>
  <div class="nav-tab" onclick="goTo('screen-profile')" id="tab-profile">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>Profil
  </div>
</nav>

<script>
const SB_URL = 'https://lmwmaqwbktiqrjgctljg.supabase.co';
const SB_KEY = 'sb_publishable_7xpalz5r3f90dGR117tJCg_z0N4rNE5';
let token=null,uid=null,profile=null,todayBilan=null;

async function api(method,path,body){
  const h={'Content-Type':'application/json','apikey':SB_KEY,'Authorization':'Bearer '+(token||SB_KEY)};
  const r=await fetch(SB_URL+path,{method,headers:h,body:body?JSON.stringify(body):undefined});
  const t=await r.text();try{return JSON.parse(t);}catch{return t;}
}
async function authApi(method,path,body){
  const h={'Content-Type':'application/json','apikey':SB_KEY};
  if(token)h['Authorization']='Bearer '+token;
  const r=await fetch(SB_URL+'/auth/v1'+path,{method,headers:h,body:body?JSON.stringify(body):undefined});
  return r.json();
}
async function dbGet(table,filter){return api('GET','/rest/v1/'+table+'?'+(filter||''));}

async function init(){
  token=localStorage.getItem('rg_token');uid=localStorage.getItem('rg_uid');
  if(token&&uid){
    try{
      const p=await dbGet('profiles','id=eq.'+uid+'&select=*');
      if(Array.isArray(p)&&p[0]){profile=p[0];showApp();}else{showAuth();}
    }catch{showAuth();}
  }else{showAuth();}
  setTimeout(()=>document.getElementById('loader').style.display='none',1200);
}

function showAuth(){document.getElementById('loader').style.display='none';goTo('screen-auth');}

function showApp(){
  document.getElementById('nav').style.display='flex';
  if(profile.role==='staff'){
    document.getElementById('tab-home').style.display='none';
    document.getElementById('tab-questionnaire').style.display='none';
    document.getElementById('tab-injuries').style.display='none';
    goTo('screen-staff');loadStaff();
  }else{
    document.getElementById('tab-staff').style.display='none';
    goTo('screen-home');loadToday();loadInjuries();loadProfileUI();
  }
}

function switchTab(t){
  document.getElementById('tabLogin').classList.toggle('active',t==='login');
  document.getElementById('tabRegister').classList.toggle('active',t==='register');
  document.getElementById('formLogin').style.display=t==='login'?'block':'none';
  document.getElementById('formRegister').style.display=t==='register'?'block':'none';
}
function togglePosition(){document.getElementById('posGroup').style.display=document.getElementById('rRole').value==='joueur'?'block':'none';}

async function doLogin(){
  const email=document.getElementById('lEmail').value.trim();
  const pwd=document.getElementById('lPwd').value;
  const err=document.getElementById('lErr');err.style.display='none';
  if(!email||!pwd){err.textContent='Remplis tous les champs';err.style.display='block';return;}
  try{
    const d=await authApi('POST','/token?grant_type=password',{email,password:pwd});
    if(!d.access_token){err.textContent='Email ou mot de passe incorrect';err.style.display='block';return;}
    token=d.access_token;uid=d.user.id;
    localStorage.setItem('rg_token',token);localStorage.setItem('rg_uid',uid);
    const p=await dbGet('profiles','id=eq.'+uid+'&select=*');
    if(!Array.isArray(p)||!p[0]){err.textContent='Profil introuvable';err.style.display='block';return;}
    profile=p[0];showApp();
  }catch{err.textContent='Erreur de connexion';err.style.display='block';}
}

async function doRegister(){
  const prenom=document.getElementById('rPrenom').value.trim();
  const nom=document.getElementById('rNom').value.trim();
  const email=document.getElementById('rEmail').value.trim();
  const pwd=document.getElementById('rPwd').value;
  const role=document.getElementById('rRole').value;
  const position=document.getElementById('rPosition').value;
  const club=document.getElementById('rClub').value.trim();
  const err=document.getElementById('rErr');err.style.display='none';
  if(!prenom||!nom||!email||!pwd){err.textContent='Remplis tous les champs';err.style.display='block';return;}
  if(pwd.length<8){err.textContent='Mot de passe minimum 8 caracteres';err.style.display='block';return;}
  try{
    const d=await authApi('POST','/signup',{email,password:pwd});
    if(!d.access_token){err.textContent=d.msg||'Erreur inscription';err.style.display='block';return;}
    token=d.access_token;uid=d.user.id;
    localStorage.setItem('rg_token',token);localStorage.setItem('rg_uid',uid);
    const h={'Content-Type':'application/json','apikey':SB_KEY,'Authorization':'Bearer '+token,'Prefer':'return=minimal'};
    await fetch(SB_URL+'/rest/v1/profiles',{method:'POST',headers:h,body:JSON.stringify({id:uid,role,nom,prenom,position,club})});
    profile={id:uid,role,nom,prenom,position,club};showApp();toast('Bienvenue '+prenom+' !');
  }catch{err.textContent='Erreur. Reessaie.';err.style.display='block';}
}

async function doLogout(){
  localStorage.removeItem('rg_token');localStorage.removeItem('rg_uid');
  token=null;uid=null;profile=null;todayBilan=null;
  document.getElementById('nav').style.display='none';
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  switchTab('login');goTo('screen-auth');
}

async function loadToday(){
  const today=new Date().toISOString().split('T')[0];
  const h=new Date().getHours();
  document.getElementById('greeting').textContent=(h<12?'BON MATIN':h<18?'BON APRES-MIDI':'BONNE SOIREE')+', '+profile.prenom.toUpperCase();
  const d=await dbGet('bilans','joueur_id=eq.'+uid+'&date=eq.'+today+'&select=*');
  todayBilan=Array.isArray(d)&&d[0]?d[0]:null;renderHome();
}

function renderHome(){
  const sc=document.getElementById('homeScore'),fi=document.getElementById('homeFill'),ms=document.getElementById('homeMsg');
  if(todayBilan&&todayBilan.score_regerent!==null){
    const s=todayBilan.score_regerent,c=todayBilan.couleur_score||'jaune';
    sc.textContent=s;sc.className='score-giant '+c;fi.className='score-fill '+c;fi.style.width=s+'%';
    ms.textContent=c==='vert'?'Pret. Donne tout.':c==='rouge'?'Ton corps parle. Ecoute-le.':'Gere ton intensite.';
    document.getElementById('bilanCTA').style.display='none';
    document.getElementById('mS').textContent=todayBilan.heures_sommeil+'h';
    document.getElementById('mP').textContent=todayBilan.ressenti_physique+'/10';
    document.getElementById('mM').textContent=todayBilan.ressenti_mental+'/10';
    const dz=todayBilan.zones_douleur||[];
    const ok=!dz.length||(dz.length===1&&dz[0]==='Aucune');
    document.getElementById('mD').textContent=ok?'OK':dz.length+' zone'+(dz.length>1?'s':'');
    const mST=document.getElementById('mST');
    if(todayBilan.heures_sommeil>=8){mST.textContent='Optimal';mST.className='metric-trend trend-up';}
    else if(todayBilan.heures_sommeil>=7){mST.textContent='Correct';mST.className='metric-trend trend-neutral';}
    else{mST.textContent='Insuffisant';mST.className='metric-trend trend-down';}
    if(todayBilan.alerte&&todayBilan.alerte_message){document.getElementById('alerteDiv').style.display='flex';document.getElementById('alerteTxt').textContent=todayBilan.alerte_message;}
    if(s<80){
      document.getElementById('protocoleDiv').style.display='block';
      const steps=[];
      if(s<60)steps.push({t:'OXY ONE - 90 minutes',d:'Priorite absolue ce soir'});
      if(!ok)steps.push({t:'CRYO ONE - zones douloureuses 20 min',d:'Cibler les zones declarees'});
      steps.push({t:(s<60?'9h':'8h')+' de sommeil minimum',d:'Coucher avant 23h'});
      document.getElementById('protocoleSteps').innerHTML=steps.map((s,i)=>`<div class="protocol-step"><div class="step-num">${i+1}</div><div><div class="step-text">${s.t}</div><div class="step-detail">${s.d}</div></div></div>`).join('');
    }
    document.getElementById('classement').textContent=Math.min(99,Math.max(10,s));
  }else{
    sc.textContent='--';ms.textContent='Complete ton bilan pour calculer ton score';
    document.getElementById('bilanCTA').style.display='block';
  }
}

let painOk=false,equipOk=false;
function tPain(el){
  if(el.textContent==='Aucune'){document.querySelectorAll('#painChips .chip').forEach(c=>c.classList.remove('sel-pain'));el.classList.add('sel-pain');}
  else{document.querySelector('#painChips .chip:first-child')?.classList.remove('sel-pain');el.classList.toggle('sel-pain');}
  painOk=document.querySelectorAll('#painChips .chip.sel-pain').length>0;calcP();
}
function tEquip(el){
  if(el.dataset.v==='Rien'){document.querySelectorAll('#equipChips .chip').forEach(c=>c.classList.remove('sel-equip'));el.classList.add('sel-equip');}
  else{document.querySelector('#equipChips [data-v="Rien"]')?.classList.remove('sel-equip');el.classList.toggle('sel-equip');}
  equipOk=document.querySelectorAll('#equipChips .chip.sel-equip').length>0;calcP();
}
function calcP(){
  let d=4;if(painOk)d++;if(equipOk)d++;
  document.getElementById('pFill').style.width=Math.round(d/6*100)+'%';
  document.getElementById('pLabel').textContent=d+' / 6';
}

async function submitBilan(){
  const btn=document.getElementById('submitBtn');btn.textContent='CALCUL...';btn.disabled=true;
  const hs=parseFloat(document.getElementById('r1').value);
  const qs=parseInt(document.getElementById('r2').value);
  const rp=parseInt(document.getElementById('r3').value);
  const rm=parseInt(document.getElementById('r4').value);
  const zd=[...document.querySelectorAll('#painChips .chip.sel-pain')].map(c=>c.textContent);
  const eu=[...document.querySelectorAll('#equipChips .chip.sel-equip')].map(c=>c.dataset.v);
  let ps=0;
  if(hs>=8)ps=20;else if(hs>=7)ps=15;else if(hs>=6)ps=8;else ps=2;
  ps+=Math.min(15,Math.round(qs*1.5));
  const pp=Math.min(25,Math.round(rp*2.5));
  const pm=Math.min(20,Math.round(rm*2));
  const ok=!zd.length||(zd.length===1&&zd[0]==='Aucune');
  const pd=ok?10:zd.length===1?5:0;
  let pe=0;if(eu.includes('OXY_ONE'))pe+=4;if(eu.includes('CRYO_ONE'))pe+=3;if(eu.includes('PRESSO_ONE'))pe+=3;pe=Math.min(10,pe);
  const score=Math.max(0,Math.min(100,ps+pp+pm+pd+pe));
  const couleur=score>=80?'vert':score>=60?'jaune':'rouge';
  let alerte=false,alerte_message=null;
  if(hs<7&&!ok){alerte=true;alerte_message='Sommeil insuffisant ('+hs+'h) combine a une douleur. Protocole recommande ce soir.';}
  else if(hs<6){alerte=true;alerte_message='Nuit tres courte ('+hs+'h). Priorise le sommeil ce soir.';}
  const today=new Date().toISOString().split('T')[0];
  const payload={joueur_id:uid,date:today,heures_sommeil:hs,qualite_sommeil:qs,ressenti_physique:rp,ressenti_mental:rm,zones_douleur:zd,equipements_utilises:eu,score_regerent:score,couleur_score:couleur,alerte,alerte_message};
  const h={'Content-Type':'application/json','apikey':SB_KEY,'Authorization':'Bearer '+token,'Prefer':'resolution=merge-duplicates'};
  await fetch(SB_URL+'/rest/v1/bilans',{method:'POST',headers:h,body:JSON.stringify(payload)});
  todayBilan=payload;btn.textContent='CALCULER MON SCORE';btn.disabled=false;
  const sEl=document.getElementById('sScore');
  sEl.textContent=score;sEl.className='score-giant '+couleur;
  document.getElementById('sMsg').textContent=couleur==='vert'?'Pret. Donne tout.':couleur==='rouge'?'Ton corps parle.':'Gere ton intensite.';
  document.getElementById('successOverlay').classList.add('show');
}
function closeSuccess(){document.getElementById('successOverlay').classList.remove('show');loadToday();goTo('screen-home');}

async function loadInjuries(){
  const d=await dbGet('blessures','joueur_id=eq.'+uid+'&order=date_blessure.desc&select=*');
  const b=Array.isArray(d)?d:[];
  const el=document.getElementById('injList');
  if(!b.length){el.innerHTML='<div class="empty-state"><div>+</div><div style="font-size:13px;margin-top:8px">Aucune blessure enregistree.</div></div>';}
  else{el.innerHTML=b.map(x=>`<div class="injury-card"><div style="display:flex;justify-content:space-between;margin-bottom:8px"><div style="font-weight:600;font-size:13px">${x.type}</div><div class="badge ${x.rechute?'badge-rouge':'badge-vert'}">${x.rechute?'RECHUTE':'OK'}</div></div><div style="display:flex;gap:12px;flex-wrap:wrap"><div style="font-size:11px;color:var(--gris-texte)">Date: <span style="color:var(--blanc)">${x.date_blessure}</span></div><div style="font-size:11px;color:var(--gris-texte)">Duree: <span style="color:var(--blanc)">${x.duree_recuperation?x.duree_recuperation+'j':'--'}</span></div></div></div>`).join('');}
  const zones={};b.forEach(x=>{zones[x.zone_corporelle]=(zones[x.zone_corporelle]||0)+1;});
  const allZ=['Ischio G','Ischio D','Genou G','Genou D','Cheville G','Cheville D','Dos','Epaules','Hanches'];
  document.getElementById('bodyZones').innerHTML=allZ.map(z=>{const n=zones[z]||0;const c=n>=2?'rouge':n===1?'orange':'vert';const dc=c==='rouge'?'var(--rouge)':c==='orange'?'var(--jaune)':'var(--vert)';return`<div class="body-zone ${c}"><div class="zone-dot" style="background:${dc}"></div>${z}</div>`;}).join('');
  const av=b.filter(x=>!x.avec_regerent),avc=b.filter(x=>x.avec_regerent);
  document.getElementById('avB').textContent=av.length||'--';document.getElementById('avcB').textContent=avc.length||'--';
  const mAv=av.length?Math.round(av.reduce((a,x)=>a+(x.duree_recuperation||0),0)/av.length):null;
  const mAvc=avc.length?Math.round(avc.reduce((a,x)=>a+(x.duree_recuperation||0),0)/avc.length):null;
  document.getElementById('avD').textContent=mAv?mAv+'j':'--';document.getElementById('avcD').textContent=mAvc?mAvc+'j':'--';
  if(mAv&&mAvc&&mAv>mAvc)document.getElementById('gainPct').textContent=Math.round((mAv-mAvc)/mAv*100)+'% plus rapide avec REGERENT';
  const bilans=await dbGet('bilans','joueur_id=eq.'+uid+'&select=score_regerent');
  const nb=Array.isArray(bilans)?bilans.length:0;
  const avg=nb?Math.round(bilans.reduce((a,x)=>a+(x.score_regerent||0),0)/nb):0;
  document.getElementById('pSess').textContent=nb;document.getElementById('pScore').textContent=avg||'--';document.getElementById('pDispo').textContent=nb>0?'96%':'--';
}

async function addInjury(){
  const type=prompt('Type de blessure :');if(!type)return;
  const zone=prompt('Zone corporelle (ex: Ischio G) :');if(!zone)return;
  const date=prompt('Date (AAAA-MM-JJ) :',new Date().toISOString().split('T')[0]);if(!date)return;
  const duree=prompt('Duree recuperation en jours :');
  const avecR=confirm('Avec REGERENT ?');const rechute=confirm('Rechute ?');
  const h={'Content-Type':'application/json','apikey':SB_KEY,'Authorization':'Bearer '+token,'Prefer':'return=minimal'};
  await fetch(SB_URL+'/rest/v1/blessures',{method:'POST',headers:h,body:JSON.stringify({joueur_id:uid,type,zone_corporelle:zone,date_blessure:date,duree_recuperation:duree?parseInt(duree):null,avec_regerent:avecR,rechute})});
  loadInjuries();toast('Blessure ajoutee');
}

function loadProfileUI(){
  if(!profile)return;
  const ini=(profile.prenom[0]+profile.nom[0]).toUpperCase();
  document.getElementById('pAvatar').textContent=ini;
  document.getElementById('pName').textContent=profile.prenom+' '+profile.nom;
  document.getElementById('pSub').textContent=[profile.position,profile.club].filter(Boolean).join(' - ');
}

async function loadStaff(){
  const today=new Date().toISOString().split('T')[0];
  document.getElementById('staffDate').textContent=new Date().toLocaleDateString('fr-FR',{weekday:'long',day:'numeric',month:'long'}).toUpperCase();
  const acces=await dbGet('acces_staff','staff_id=eq.'+uid+'&actif=eq.true&select=joueur_id');
  if(!Array.isArray(acces)||!acces.length)return;
  const ids=acces.map(a=>a.joueur_id);
  const joueurs=await dbGet('profiles','id=in.('+ids.join(',')+')'+'&select=*');
  const bilans=await dbGet('bilans','joueur_id=in.('+ids.join(',')+')'+'&date=eq.'+today+'&select=*');
  const bMap={};(Array.isArray(bilans)?bilans:[]).forEach(b=>bMap[b.joueur_id]=b);
  const av=Object.keys(bMap).length,al=(Array.isArray(bilans)?bilans:[]).filter(b=>b.alerte).length;
  document.getElementById('sBilans').textContent=av;document.getElementById('sAlertes').textContent=al;document.getElementById('sAttente').textContent=ids.length-av;
  const rows=(Array.isArray(joueurs)?joueurs:[]).map(j=>{const b=bMap[j.id];const s=b?.score_regerent;const c=b?.couleur_score||'vide';return{j,b,s,c};});
  document.getElementById('staffList').innerHTML=rows.length?rows.map(r=>{const ini=(r.j.prenom[0]+r.j.nom[0]).toUpperCase();const bg=r.c==='rouge'?'rgba(231,76,60,0.15)':r.c==='vert'?'rgba(46,204,113,0.15)':r.c==='jaune'?'rgba(243,156,18,0.15)':'#2A2A2A';const tc=r.c==='rouge'?'var(--rouge-soft)':r.c==='vert'?'var(--vert)':r.c==='jaune'?'var(--jaune)':'var(--gris-texte)';const det=r.b?`${r.b.alerte?'! ':''}${(r.b.zones_douleur||[]).filter(z=>z!='Aucune').join(', ')||'Aucune douleur'} - ${r.b.heures_sommeil}h sommeil`:'Bilan non complete';return`<div class="player-row"><div class="player-avatar" style="background:${bg};color:${tc}">${ini}</div><div class="player-info"><div class="player-name">${r.j.prenom} ${r.j.nom}</div><div class="player-detail">${det}</div></div><div class="score-badge ${r.c}">${r.s??'--'}</div></div>`;}).join(''):'<div class="empty-state"><div>+</div><div style="font-size:13px;margin-top:8px">Aucun joueur.</div></div>';
}

function goTo(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  const m={'screen-home':'tab-home','screen-questionnaire':'tab-questionnaire','screen-injuries':'tab-injuries','screen-staff':'tab-staff','screen-profile':'tab-profile'};
  document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
  if(m[id])document.getElementById(m[id])?.classList.add('active');
  document.querySelector('#'+id+' .content')?.scrollTo(0,0);
}
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3000);}

init();
</script>

</body>
</html>
